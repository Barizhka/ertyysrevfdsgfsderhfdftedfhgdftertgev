<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnate OTC - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏</title>
    <style>
        :root {
            --primary: #2E8B57;
            --primary-dark: #1F6B41;
            --secondary: #FFD700;
            --dark: #1A1A1A;
            --light: #F5F5F5;
            --gray: #666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #2D2D2D 100%);
            color: var(--light);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--secondary);
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .deal-form, .ticket-form {
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 16px;
        }
        
        .ticket-system, .admin-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
        }
        
        .deal-list, .ticket-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .deal-item, .ticket-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .deal-item.completed {
            border-left-color: var(--secondary);
        }
        
        .deal-item.cancelled {
            border-left-color: #dc3545;
        }
        
        .ticket-item.open {
            border-left-color: var(--primary);
        }
        
        .ticket-item.in_progress {
            border-left-color: var(--secondary);
        }
        
        .ticket-item.closed {
            border-left-color: #dc3545;
        }
        
        .hidden {
            display: none;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn.active {
            background: var(--primary);
        }
        
        .user-profile {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .auth-section {
            text-align: center;
            padding: 40px;
        }
        
        .deal-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active { background: var(--primary); }
        .status-completed { background: var(--secondary); color: #000; }
        .status-cancelled { background: #dc3545; }
        .status-open { background: var(--primary); }
        .status-in_progress { background: var(--secondary); color: #000; }
        .status-closed { background: #dc3545; }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: var(--primary); }
        .notification.error { background: #dc3545; }
        .notification.warning { background: var(--secondary); color: #000; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ü§µ Magnate OTC</div>
            <div class="tagline">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ P2P —Å–¥–µ–ª–∫–∏ —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π</div>
            <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–æ–≤ —Å –∑–∞—â–∏—Ç–æ–π –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω</p>
        </div>

        <div id="auth-section" class="auth-section">
            <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram</p>
            <br>
            <a href="https://t.me/magnateotcbot" class="btn" target="_blank">
                üì± –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            </a>
            <br><br>
            <div class="form-group">
                <label>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID (–ø–æ–ª—É—á–∏—Ç–µ –≤ –±–æ—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π /id):</label>
                <input type="number" id="user-id" placeholder="123456789">
                <button class="btn" onclick="authUser()" style="margin-top: 10px; width: 100%;">
                    –í–æ–π—Ç–∏
                </button>
            </div>
        </div>

        <div id="app-content" class="hidden">
            <div class="user-profile" id="user-profile">
                <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <div id="profile-info"></div>
            </div>

            <div class="nav">
                <button class="nav-btn active" onclick="showSection('main')">–ì–ª–∞–≤–Ω–∞—è</button>
                <button class="nav-btn" onclick="showSection('deals')">–°–¥–µ–ª–∫–∏</button>
                <button class="nav-btn" onclick="showSection('create-deal')">–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>
                <button class="nav-btn" onclick="showSection('tickets')">–¢–∏–∫–µ—Ç—ã</button>
                <button class="nav-btn" onclick="showSection('admin')" id="admin-btn" style="display: none;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                <button class="nav-btn btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>

            <!-- –ì–ª–∞–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
            <div id="main" class="section">
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="total-deals">0</h3>
                        <p>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="active-deals">0</h3>
                        <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="user-balance">0</h3>
                        <p>–í–∞—à –±–∞–ª–∞–Ω—Å</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="successful-deals">0</h3>
                        <p>–í–∞—à–∏—Ö —É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</p>
                    </div>
                </div>

                <div class="features">
                    <div class="feature-card">
                        <h3>üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                        <p>–í—Å–µ —Å–¥–µ–ª–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã —ç—Å–∫—Ä–æ—É-—Å–∏—Å—Ç–µ–º–æ–π. –°—Ä–µ–¥—Å—Ç–≤–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è —É –≥–∞—Ä–∞–Ω—Ç–∞ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è.</p>
                    </div>
                    <div class="feature-card">
                        <h3>‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏</h3>
                        <p>–ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
                    </div>
                    <div class="feature-card">
                        <h3>üåê –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å</h3>
                        <p>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ TON, RUB —á–µ—Ä–µ–∑ –°–ë–ü, Telegram Stars –∏ –¥—Ä—É–≥–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã.</p>
                    </div>
                    <div class="feature-card">
                        <h3>üì± –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
                        <p>–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –∏ –≤–µ–±-–≤–µ—Ä—Å–∏—é. –£–¥–æ–±–Ω–æ –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <a href="https://t.me/magnateotcbot" class="btn" style="margin-right: 15px;" target="_blank">
                        üì± –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram
                    </a>
                    <button class="btn btn-secondary" onclick="showSection('create-deal')">
                        üíº –ù–∞—á–∞—Ç—å —Å–¥–µ–ª–∫—É
                    </button>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ -->
            <div id="deals" class="section hidden">
                <h2 style="text-align: center; margin-bottom: 30px;">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏</h2>
                <div class="loading" id="deals-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫...</div>
                <div class="deal-list" id="deals-list">
                    <!-- –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ -->
            <div id="create-deal" class="section hidden">
                <h2 style="text-align: center; margin-bottom: 30px;">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏</h2>
                
                <div class="deal-form">
                    <div class="form-group">
                        <label>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
                        <select id="payment-method">
                            <option value="ton">TON</option>
                            <option value="sbp">–°–ë–ü (RUB)</option>
                            <option value="stars">Telegram Stars</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–°—É–º–º–∞:</label>
                        <input type="number" id="deal-amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                    </div>
                    
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏:</label>
                        <textarea id="deal-description" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ —É—Å–ª–æ–≤–∏—è —Å–¥–µ–ª–∫–∏..."></textarea>
                    </div>
                    
                    <button class="btn" onclick="createDeal()" style="width: 100%;">
                        –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
                    </button>
                </div>
            </div>

            <!-- –°–∏—Å—Ç–µ–º–∞ —Ç–∏–∫–µ—Ç–æ–≤ -->
            <div id="tickets" class="section hidden">
                <h2 style="text-align: center; margin-bottom: 30px;">–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h2>
                
                <div class="ticket-system">
                    <button class="btn" onclick="showCreateTicket()" style="margin-bottom: 20px;">
                        üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏–∫–µ—Ç
                    </button>
                    
                    <div id="create-ticket-form" class="ticket-form hidden">
                        <div class="form-group">
                            <label>–¢–µ–º–∞ —Ç–∏–∫–µ—Ç–∞:</label>
                            <input type="text" id="ticket-subject" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É">
                        </div>
                        <div class="form-group">
                            <label>–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                            <textarea id="ticket-message" rows="4" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É..."></textarea>
                        </div>
                        <button class="btn" onclick="createTicket()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–∫–µ—Ç</button>
                    </div>
                    
                    <h3>–ú–æ–∏ —Ç–∏–∫–µ—Ç—ã</h3>
                    <div class="loading" id="tickets-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...</div>
                    <div class="ticket-list" id="tickets-list">
                        <!-- –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
            <div id="admin" class="section hidden">
                <h2 style="text-align: center; margin-bottom: 30px;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                
                <div class="admin-panel">
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="admin-total-users">0</h3>
                            <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="admin-total-deals">0</h3>
                            <p>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="admin-active-deals">0</h3>
                            <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="admin-open-tickets">0</h3>
                            <p>–û—Ç–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤</p>
                        </div>
                    </div>

                    <div class="nav">
                        <button class="nav-btn active" onclick="showAdminSection('deals')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∞–º–∏</button>
                        <button class="nav-btn" onclick="showAdminSection('tickets')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏</button>
                        <button class="nav-btn" onclick="showAdminSection('users')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</button>
                    </div>

                    <div id="admin-deals" class="admin-section">
                        <h3>–í—Å–µ —Å–¥–µ–ª–∫–∏</h3>
                        <div class="loading" id="admin-deals-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫...</div>
                        <div class="deal-list" id="admin-deals-list">
                            <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
                        </div>
                    </div>

                    <div id="admin-tickets" class="admin-section hidden">
                        <h3>–í—Å–µ —Ç–∏–∫–µ—Ç—ã</h3>
                        <div class="loading" id="admin-tickets-loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...</div>
                        <div class="ticket-list" id="admin-tickets-list">
                            <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
                        </div>
                    </div>

                    <div id="admin-users" class="admin-section hidden">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                        <div class="ticket-form">
                            <div class="form-group">
                                <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                                <input type="number" id="admin-user-id" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                            </div>
                            <div class="form-group">
                                <label>–î–µ–π—Å—Ç–≤–∏–µ:</label>
                                <select id="admin-user-action">
                                    <option value="balance">–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</option>
                                    <option value="deals">–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫</option>
                                    <option value="admin">–ù–∞–∑–Ω–∞—á–∏—Ç—å/—Å–Ω—è—Ç—å –∞–¥–º–∏–Ω–∞</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                                <input type="text" id="admin-user-value" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                            </div>
                            <button class="btn" onclick="adminUserAction()">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API —ç–º—É–ª—è—Ç–æ—Ä –¥–ª—è GitHub Pages
        class MagnateAPI {
            constructor() {
                this.botUsername = 'magnateotcbot';
                this.storageKey = 'magnate_otc_data';
                this.init();
            }

            init() {
                if (!localStorage.getItem(this.storageKey)) {
                    const initialData = {
                        users: {
                            '7674627532': {
                                user_id: 7674627532,
                                username: 'admin1',
                                balance: 10000,
                                successful_deals: 50,
                                ton_wallet: 'UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ',
                                card_details: '5536914111052341',
                                is_admin: true
                            },
                            '8312808945': {
                                user_id: 8312808945,
                                username: 'admin2',
                                balance: 8000,
                                successful_deals: 30,
                                ton_wallet: 'UQBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB',
                                card_details: '5536914222156789',
                                is_admin: true
                            }
                        },
                        deals: {},
                        tickets: {},
                        sessions: {}
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(initialData));
                }
            }

            getData() {
                return JSON.parse(localStorage.getItem(this.storageKey));
            }

            saveData(data) {
                localStorage.setItem(this.storageKey, JSON.stringify(data));
            }

            async callBotMethod(method, params = {}) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const data = this.getData();
                let response;

                switch (method) {
                    case 'auth':
                        const userId = params.user_id.toString();
                        if (!data.users[userId]) {
                            data.users[userId] = {
                                user_id: parseInt(userId),
                                username: `user_${userId}`,
                                balance: 1000,
                                successful_deals: 0,
                                ton_wallet: '',
                                card_details: '',
                                is_admin: userId === '7674627532' || userId === '8312808945'
                            };
                        }
                        
                        const sessionId = 'session_' + Math.random().toString(36).substr(2, 9);
                        data.sessions[sessionId] = userId;
                        this.saveData(data);
                        
                        response = {
                            session_id: sessionId,
                            user: data.users[userId]
                        };
                        break;

                    case 'create_deal':
                        const dealId = 'deal_' + Math.random().toString(36).substr(2, 9);
                        const userIdForDeal = data.sessions[params.sessionId];
                        data.deals[dealId] = {
                            deal_id: dealId,
                            amount: parseFloat(params.amount),
                            description: params.description,
                            payment_method: params.payment_method,
                            seller_id: parseInt(userIdForDeal),
                            seller_username: data.users[userIdForDeal]?.username || 'Unknown',
                            seller_successful_deals: data.users[userIdForDeal]?.successful_deals || 0,
                            buyer_id: null,
                            status: 'active',
                            created_at: new Date().toISOString()
                        };
                        this.saveData(data);
                        
                        response = {
                            success: true,
                            deal_id: dealId,
                            deal_link: `https://t.me/${this.botUsername}?start=${dealId}`
                        };
                        break;

                    case 'get_active_deals':
                        const activeDeals = Object.values(data.deals).filter(deal => deal.status === 'active');
                        response = { deals: activeDeals };
                        break;

                    case 'create_ticket':
                        const ticketId = 'ticket_' + Math.random().toString(36).substr(2, 9);
                        const userIdForTicket = data.sessions[params.sessionId];
                        data.tickets[ticketId] = {
                            ticket_id: ticketId,
                            user_id: parseInt(userIdForTicket),
                            username: data.users[userIdForTicket]?.username || 'Unknown',
                            subject: params.subject,
                            message: params.message,
                            status: 'open',
                            admin_id: null,
                            admin_username: null,
                            created_at: new Date().toISOString()
                        };
                        this.saveData(data);
                        
                        response = {
                            success: true,
                            ticket_id: ticketId
                        };
                        break;

                    case 'get_my_tickets':
                        const userIdForMyTickets = data.sessions[params.sessionId];
                        const userTickets = Object.values(data.tickets).filter(
                            ticket => ticket.user_id === parseInt(userIdForMyTickets)
                        );
                        response = { tickets: userTickets };
                        break;

                    case 'get_user_profile':
                        const userIdForProfile = data.sessions[params.sessionId];
                        const user = data.users[userIdForProfile];
                        response = user || { error: 'User not found' };
                        break;

                    case 'get_admin_deals':
                        if (!this.isAdmin(params.sessionId, data)) {
                            response = { error: 'Forbidden' };
                        } else {
                            response = { deals: Object.values(data.deals) };
                        }
                        break;

                    case 'get_admin_tickets':
                        if (!this.isAdmin(params.sessionId, data)) {
                            response = { error: 'Forbidden' };
                        } else {
                            response = { tickets: Object.values(data.tickets) };
                        }
                        break;

                    case 'get_admin_stats':
                        if (!this.isAdmin(params.sessionId, data)) {
                            response = { error: 'Forbidden' };
                        } else {
                            response = {
                                total_users: Object.keys(data.users).length,
                                total_deals: Object.keys(data.deals).length,
                                active_deals: Object.values(data.deals).filter(d => d.status === 'active').length,
                                completed_deals: Object.values(data.deals).filter(d => d.status === 'completed').length,
                                open_tickets: Object.values(data.tickets).filter(t => t.status === 'open').length
                            };
                        }
                        break;

                    default:
                        response = { error: 'Unknown method' };
                }

                return response;
            }

            getUserIdFromSession(sessionId, data) {
                return data.sessions[sessionId];
            }

            isAdmin(sessionId, data) {
                const userId = this.getUserIdFromSession(sessionId, data);
                return data.users[userId]?.is_admin === true;
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let sessionId = localStorage.getItem('session_id');
        const api = new MagnateAPI();

        // –£—Ç–∏–ª–∏—Ç—ã
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showLoading(elementId) {
            document.getElementById(elementId).classList.remove('hidden');
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.addEventListener('load', () => {
            if (sessionId) {
                checkAuth();
            }
        });

        async function checkAuth() {
            try {
                const response = await api.callBotMethod('get_user_profile', { sessionId });
                
                if (response.error) {
                    localStorage.removeItem('session_id');
                    sessionId = null;
                } else {
                    currentUser = response;
                    showAppContent();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('session_id');
                sessionId = null;
            }
        }

        async function authUser() {
            const userId = document.getElementById('user-id').value;
            if (!userId) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID', 'error');
                return;
            }

            try {
                const response = await api.callBotMethod('auth', { user_id: userId });

                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + response.error, 'error');
                } else {
                    sessionId = response.session_id;
                    currentUser = response.user;
                    localStorage.setItem('session_id', sessionId);
                    showAppContent();
                    showNotification('–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', 'success');
                }
            } catch (error) {
                console.error('Auth error:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        function showAppContent() {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            updateUserProfile();
            loadStats();
            
            if (currentUser.is_admin) {
                document.getElementById('admin-btn').style.display = 'inline-block';
            }
        }

        function logout() {
            localStorage.removeItem('session_id');
            sessionId = null;
            currentUser = null;
            document.getElementById('app-content').classList.add('hidden');
            document.getElementById('auth-section').classList.remove('hidden');
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
        }

        function updateUserProfile() {
            const profileInfo = document.getElementById('profile-info');
            profileInfo.innerHTML = `
                <p><strong>ID:</strong> ${currentUser.user_id}</p>
                <p><strong>Username:</strong> @${currentUser.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> ${currentUser.balance} RUB</p>
                <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:</strong> ${currentUser.successful_deals}</p>
                <p><strong>TON –∫–æ—à–µ–ª–µ–∫:</strong> ${currentUser.ton_wallet || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                <p><strong>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞:</strong> ${currentUser.card_details || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                ${currentUser.is_admin ? '<p><strong>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</strong></p>' : ''}
            `;
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(sectionName).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (sectionName === 'deals') {
                loadDeals();
            } else if (sectionName === 'tickets') {
                loadTickets();
            } else if (sectionName === 'admin') {
                loadAdminData();
            }
        }

        function showAdminSection(sectionName) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            document.getElementById(`admin-${sectionName}`).classList.remove('hidden');
            
            document.querySelectorAll('#admin .nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        async function loadStats() {
            try {
                document.getElementById('user-balance').textContent = currentUser.balance;
                document.getElementById('successful-deals').textContent = currentUser.successful_deals;

                const dealsResponse = await api.callBotMethod('get_active_deals', { sessionId });
                if (dealsResponse.deals) {
                    document.getElementById('total-deals').textContent = dealsResponse.deals.length;
                    document.getElementById('active-deals').textContent = dealsResponse.deals.length;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadDeals() {
            showLoading('deals-loading');
            try {
                const response = await api.callBotMethod('get_active_deals', { sessionId });

                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–¥–µ–ª–æ–∫: ' + response.error, 'error');
                } else {
                    displayDeals(response.deals);
                }
            } catch (error) {
                console.error('Error loading deals:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoading('deals-loading');
            }
        }

        function displayDeals(deals) {
            const dealsList = document.getElementById('deals-list');
            
            if (deals.length === 0) {
                dealsList.innerHTML = '<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</p>';
                return;
            }

            dealsList.innerHTML = deals.map(deal => `
                <div class="deal-item ${deal.status}">
                    <h4>–°–¥–µ–ª–∫–∞ #${deal.deal_id.slice(0, 8)}</h4>
                    <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> @${deal.seller_username}</p>
                    <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:</strong> ${deal.seller_successful_deals}</p>
                    <p><strong>–°—É–º–º–∞:</strong> ${deal.amount} ${deal.payment_method.toUpperCase()}</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${deal.description}</p>
                    <div class="deal-actions">
                        <a href="${deal.deal_link}" class="btn" target="_blank">üíº –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–¥–µ–ª–∫–µ</a>
                    </div>
                </div>
            `).join('');
        }

        async function createDeal() {
            const amount = document.getElementById('deal-amount').value;
            const description = document.getElementById('deal-description').value;
            const paymentMethod = document.getElementById('payment-method').value;
            
            if (!amount || !description) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const response = await api.callBotMethod('create_deal', {
                    sessionId,
                    amount: amount,
                    description: description,
                    payment_method: paymentMethod
                });

                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏: ' + response.error, 'error');
                } else {
                    showNotification(`–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –°—Å—ã–ª–∫–∞: ${response.deal_link}`, 'success');
                    document.getElementById('deal-amount').value = '';
                    document.getElementById('deal-description').value = '';
                    showSection('deals');
                    loadDeals();
                }
            } catch (error) {
                console.error('Error creating deal:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        function showCreateTicket() {
            document.getElementById('create-ticket-form').classList.remove('hidden');
        }

        async function createTicket() {
            const subject = document.getElementById('ticket-subject').value;
            const message = document.getElementById('ticket-message').value;
            
            if (!subject || !message) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const response = await api.callBotMethod('create_ticket', {
                    sessionId,
                    subject: subject,
                    message: message
                });

                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞: ' + response.error, 'error');
                } else {
                    showNotification('–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω! ID: ' + response.ticket_id, 'success');
                    document.getElementById('ticket-subject').value = '';
                    document.getElementById('ticket-message').value = '';
                    document.getElementById('create-ticket-form').classList.add('hidden');
                    loadTickets();
                }
            } catch (error) {
                console.error('Error creating ticket:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        async function loadTickets() {
            showLoading('tickets-loading');
            try {
                const response = await api.callBotMethod('get_my_tickets', { sessionId });

                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤: ' + response.error, 'error');
                } else {
                    displayTickets(response.tickets);
                }
            } catch (error) {
                console.error('Error loading tickets:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            } finally {
                hideLoading('tickets-loading');
            }
        }

        function displayTickets(tickets) {
            const ticketsList = document.getElementById('tickets-list');
            
            if (tickets.length === 0) {
                ticketsList.innerHTML = '<p>–£ –≤–∞—Å –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤</p>';
                return;
            }

            ticketsList.innerHTML = tickets.map(ticket => `
                <div class="ticket-item ${ticket.status}">
                    <h4>${ticket.subject}</h4>
                    <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${ticket.message}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status-badge status-${ticket.status}">${getStatusText(ticket.status)}</span></p>
                    <p><strong>–°–æ–∑–¥–∞–Ω:</strong> ${new Date(ticket.created_at).toLocaleDateString()}</p>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            const statuses = {
                'open': '–û—Ç–∫—Ä—ã—Ç',
                'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
                'closed': '–ó–∞–∫—Ä—ã—Ç'
            };
            return statuses[status] || status;
        }

        async function loadAdminData() {
            if (!currentUser.is_admin) return;

            try {
                const statsResponse = await api.callBotMethod('get_admin_stats', { sessionId });
                if (statsResponse.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + statsResponse.error, 'error');
                } else {
                    document.getElementById('admin-total-users').textContent = statsResponse.total_users;
                    document.getElementById('admin-total-deals').textContent = statsResponse.total_deals;
                    document.getElementById('admin-active-deals').textContent = statsResponse.active_deals;
                    document.getElementById('admin-open-tickets').textContent = statsResponse.open_tickets;
                }

                await loadAdminDeals();
                await loadAdminTickets();

            } catch (error) {
                console.error('Error loading admin data:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        async function loadAdminDeals() {
            showLoading('admin-deals-loading');
            try {
                const response = await api.callBotMethod('get_admin_deals', { sessionId });
                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–¥–µ–ª–æ–∫: ' + response.error, 'error');
                } else {
                    displayAdminDeals(response.deals);
                }
            } catch (error) {
                console.error('Error loading admin deals:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–¥–µ–ª–æ–∫', 'error');
            } finally {
                hideLoading('admin-deals-loading');
            }
        }

        function displayAdminDeals(deals) {
            const dealsList = document.getElementById('admin-deals-list');
            
            if (deals.length === 0) {
                dealsList.innerHTML = '<p>–ù–µ—Ç —Å–¥–µ–ª–æ–∫</p>';
                return;
            }

            dealsList.innerHTML = deals.map(deal => `
                <div class="deal-item ${deal.status}">
                    <h4>–°–¥–µ–ª–∫–∞ #${deal.deal_id.slice(0, 8)}</h4>
                    <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> @${deal.seller_username} (${deal.seller_successful_deals} —Å–¥–µ–ª–æ–∫)</p>
                    <p><strong>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:</strong> @${deal.buyer_username || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</p>
                    <p><strong>–°—É–º–º–∞:</strong> ${deal.amount} ${deal.payment_method.toUpperCase()}</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${deal.description}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status-badge status-${deal.status}">${getStatusText(deal.status)}</span></p>
                </div>
            `).join('');
        }

        async function loadAdminTickets() {
            showLoading('admin-tickets-loading');
            try {
                const response = await api.callBotMethod('get_admin_tickets', { sessionId });
                if (response.error) {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤: ' + response.error, 'error');
                } else {
                    displayAdminTickets(response.tickets);
                }
            } catch (error) {
                console.error('Error loading admin tickets:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤', 'error');
            } finally {
                hideLoading('admin-tickets-loading');
            }
        }

        function displayAdminTickets(tickets) {
            const ticketsList = document.getElementById('admin-tickets-list');
            
            if (tickets.length === 0) {
                ticketsList.innerHTML = '<p>–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤</p>';
                return;
            }

            ticketsList.innerHTML = tickets.map(ticket => `
                <div class="ticket-item ${ticket.status}">
                    <h4>${ticket.subject} (#${ticket.ticket_id})</h4>
                    <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> @${ticket.username} (ID: ${ticket.user_id})</p>
                    <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${ticket.message}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status-badge status-${ticket.status}">${getStatusText(ticket.status)}</span></p>
                    <p><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> ${ticket.admin_username || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</p>
                </div>
            `).join('');
        }

        function adminUserAction() {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –¥–ª—è –ø—Ä—è–º–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏
        const urlParams = new URLSearchParams(window.location.search);
        const dealId = urlParams.get('deal');
        if (dealId && sessionId) {
            showSection('deals');
        }
    </script>
</body>
</html>
